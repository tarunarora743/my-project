<!--
  Student Name: Aarya Hattangdi
  Student Number: 46346953
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>FlowTow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Include Handlebars from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script src="./js/main.js" type=module defer></script>
  </head>
  <body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <nav id="topdiv">
          <ul id="logo">
              
              <li><a class="topmenu" id="home" href="#" >Home</a></li>
              
              
              <li><a class="topmenu" id="allposts" href="#!/all-posts" >All Posts</a></li>
              
              
              <li><a class="topmenu" id="myposts" href="#!/my-posts" >My Posts</a></li>
              
              
              <li><a class="topmenu" href="#whatis" >About</a></li>
              
          </ul>
      </nav>
      <!--09May2021 Added the below section to change document view dependant upon -->
      <script type="module">
        //example using jquery
        $('.topmenu').click(function(event){
          //event.preventDefault();
          $(this).css("color", "white");
          
          

        });


     

       

      </script>
      <!--*****************09May2021 Added the above ************************************ -->


        <!--08May2021script for loggin in -->
        <script type="module">
          import {Auth} from "/js/service.js" 
  
          var formElem = document.getElementById("loginform") 
          formElem.onsubmit = async (e) => {
            e.preventDefault();
            var data = new FormData(formElem);
            const username = data.get("username");
            const password = data.get("password");
  
  
            let result = await Auth.login(username, password);
  
            if (result.status ===200){
              var newLoginLayout = document.getElementById("loginform");
              newLoginLayout.innerHTML = `<a><b>Logged in as ${username} </b></a><input type="button" class="logout" value="Logout" style="float: right;">`
            }else{
              var newLoginFailLayout = document.getElementById("errorTarget");
              var loginFailElement = document.createElement('a');
              //clearing the input form
              document.getElementById("username").value= '';
              document.getElementById("password").value = '';

              newLoginFailLayout.innerHTML = `<b style="color:red;">Login Failed, please try again</b>`;
            }
          }
  
         </script>
        <!--******************************script for login implemented above-->

    <div id="content">
      <!-- Form for login added 8 May2021-->
      <form id="loginform" style="margin-top: 10px;">
        <a style="margin-right: 5px;">User :</a>
        <input type="text" name="username" id="username" placeholder="Your username"/>
        <a style="margin-right: 5px;">Password :</a>
        <input type="password" name="password" id="password" placeholder="Your password"/>
        <input type="submit">
        <a id="errorTarget"></a>
       </form> 
     <!--form implemented above-->
      <div id="heading">

          <hgroup>
              <h1>Welcome to FlowTow!</h1>
          </hgroup>
      
          

      </div>
    </div>
  <div id = "bigdiv">
    </div>

      <!-- about section-->
  <section id="whatis">
    <div>
      <h3>What is FlowTow?</h3>
      <a>FlowTow is new, exciting, image sharing service like nothing you've seen before!</a>
      <br>
      <a>FlowTow supports logging in users, posting images, making comments and viewing images in various ways.</a>
    </div>
  </section>

  <footer>

    <div >
      <ul class="social">
        <li class="sociallist"><a href="#"><i class="fa fa-twitter"></i></a></li>
        <li class="sociallist"><a href="#"><i class="fa fa-facebook"></i></a></li>
        <li class="sociallist"><a href="#"><i href="#" class="fa fa-instagram"></a></i></li>
        <li class="sociallist"><a href="#">Terms</a></li>
        <li class="sociallist"><a href="#">Privacy</a></li>
        <li class="sociallist"><a href="#">Cookies</a></li>
      </ul>
    </div>

    
    
  </footer>
  <p id="copyright">All content and images subject to copyright &copy; COMP2110/6110 FlowTow 2021.</p>




  <!--Script for doing the most recent and popular posts-->
  <script type="module"> //script for adding images by timestamp.. involves sorting the array of objects with their timestamp
    import{Model} from '/js/model.js'
    import {Views} from '/js/views.js'
    import {Auth} from '/js/service.js'
        
        //Event listener for allposts
        document.getElementById("allposts").addEventListener("click", async function(){
        var postdata = await Model.getPosts2();
        if (postdata.length >0){
        var targetdiv = document.getElementById("bigdiv");
        var div8 = ''      // ******Add a heading for all posts************
        for (var i=0; i<postdata.length; i++){
         div8 += `<div class="divforAllPostsView"><img src="${postdata[i].p_url}"><div class="divcaption">${postdata[i].p_caption} by  ${postdata[i].p_author.username} </div><div class="divcomments">Comments</div></div>`
        }
        document.getElementById("bigdiv").innerHTML =  div8;
        //document.getElementById("bigdiv").innerHTML +="wowzaaa33333"  //change this line later
        }else{
          document.getElementById("bigdiv").innerHTML =  "No data found";
        }

        })

        document.getElementById("home").addEventListener("click", function(){
          makeHomeView();
        })


        //Event listener for myposts
        document.getElementById("myposts").addEventListener("click", function(){
          if (Auth.userData){
            var contentdiv = Views.createPostView;
            for (var i=0; i<Auth.userData.user.posts.length; i++){
              contentdiv += `<div class="divforMyPostsView"><img src="${Auth.userData.user.posts[i].p_url}"><div class="divcaption">${Auth.userData.user.posts[i].p_caption}</div><div class="divcomments">Comments<ul><li>${Auth.userData.user.comment.c_content}</li></ul></div><div class="divdelete"><button name="${Auth.userData.user.posts[i].id}" class="delete" type=button>Delete</button></div></div>` ;
            }
            document.getElementById("bigdiv").innerHTML = `<div class="heading2">My Posts</div>`
            document.getElementById("bigdiv").innerHTML += contentdiv;
            
          }else{
            var contentdiv = Views.createPostView;
            document.getElementById("bigdiv").innerHTML =  "<b>You have to login first</b>";
            document.getElementById("bigdiv").innerHTML += contentdiv
          }
        })

      //Event listener for myposts above


    async function  makeHomeView(){
    var recentPostData = [];
     
     recentPostData = await Model.getPosts2();  


     //making 3 random post layout
     var mydata = recentPostData
     document.getElementById("bigdiv").innerHTML =  Views.mainPageView;
     for (var i=0; i<3; i++){
                var index = Math.floor(Math.random() * mydata.length);
                var div1 = document.createElement('div');        // Create an <img> element.
                div1.innerHTML = '<img src='+mydata[index].p_url+'>' + '<a class="caption">'+ mydata[index].p_caption + ' by ' + mydata[index].p_author.username + ' <b>' + mydata[index].p_likes + '</b></a>';                 //giving the image url from data
                document.getElementById('three-images').appendChild(div1);  //appending the image to the div
              }       
     var popularPostData = recentPostData;   
     recentPostData.sort(function(a,b){
      return new Date(b.published_at) - new Date(a.published_at);
     });

     //making recent posts layout
     for (var i=0; i<10; i++){
       var div4 = document.createElement('div');        // Create an <div> element.
       div4.className = "divforposts"
       //div4.innerHTML = '<img src='+recentPostData[i].p_url+'>' + '<a style="padding-bottom: 20px;">'+ recentPostData[i].p_caption + ' by ' + recentPostData[i].p_author.username + ' &nbsp &nbsp &nbsp' + recentPostData[i].published_at.split('T')[0] + ' <span style="color:blue;";><b>' + ' &nbsp' + recentPostData[i].p_likes + '</b></span></a><button class="like" type="button" style="float: right;">Like</button>';
       div4.innerHTML = `<img src=${recentPostData[i].p_url}><div class="divcaption">${recentPostData[i].p_caption} by  ${recentPostData[i].p_author.username} </div><div class="divpublishedat"> ${recentPostData[i].published_at.split('T')[0]}</div> <div class="divlikes">${recentPostData[i].p_likes}</div><button class="like" type="button" name="${recentPostData[i].id}" style="float: right;">Like</button>`;                 //giving the image url from data
       document.getElementById('lefthandsidediv').appendChild(div4);  //appending the element to parent div
     }

     //Making popular posts layout
     popularPostData.sort(function(a,b){
      return b.p_likes - a.p_likes;
     });
 
      for (i=0; i<10; i++){
        var div3 = document.createElement('div');        // Create an <div> element.
        div3.className = "divforposts"
        //div3.innerHTML = '<img src='+popularPostData[i].p_url+'>' + '<a style="padding-bottom: 20px;">'+ popularPostData[i].p_caption + ' by ' + popularPostData[i].p_author.username + ' &nbsp &nbsp &nbsp' + popularPostData[i].published_at.split("T" , 1) + ' <span style="color:blue;";><b>' + ' &nbsp' + popularPostData[i].p_likes + '</b></span></a><button class="like" type="button" style="float: right;">Like</button>';                 //giving the image url from data
        div3.innerHTML = `<img src=${popularPostData[i].p_url}><div class="divcaption">${popularPostData[i].p_caption} by  ${popularPostData[i].p_author.username} </div><div class="divpublishedat"> ${popularPostData[i].published_at.split('T')[0]}</div> <div class="divlikes">${popularPostData[i].p_likes}</div><button class="like" type="button" name="${popularPostData[i].id}" style="float: right;">Like</button>`;            
        document.getElementById('righthandsidediv').appendChild(div3);  //appending the element to parent div
      }
     
    }
    
    await makeHomeView();  


  
   
     
              
   </script>

  

  </body>
</html>
