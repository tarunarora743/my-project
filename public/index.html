<!--
  Student Name: Aarya Hattangdi
  Student Number: 46346953
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>FlowTow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Include Handlebars from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script src="./js/main.js" type=module defer></script>
  </head>
  <body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <nav id="topdiv">
          <ul id="logo">
              
              <li><a class="topmenu" href="#" >Home</a></li>
              
              
              <li><a class="topmenu" id="allposts" href="#!/all-posts" >All Posts</a></li>
              
              
              <li><a class="topmenu" href="#!/my-posts" >My Posts</a></li>
              
              
              <li><a class="topmenu" href="#whatis" >About</a></li>
              
          </ul>
      </nav>
      <!--09May2021 Added the below section to change document view dependant upon -->
      <script type="module">
        //example using jquery
        $('.topmenu').click(function(event){
          //event.preventDefault();
          $(this).css("color", "white");
          
          

        });

        console.log("came here11")

        import {Views} from '/js/views.js'
        //example using js
        document.getElementById("allposts").addEventListener("click", function(){
          console.log("came here22")
          var allPostsView = document.createElement('div');
          allPostsView.innerHTML = Views.allPostsView ;
          document.getElementById("bigdiv").innerHTML =  Views.allPostsView;
        })

       

      </script>
      <!--*****************09May2021 Added the above ************************************ -->


        <!--08May2021script for loggin in -->
        <script type="module">
          import {Auth} from "/js/service.js" 
  
          var formElem = document.getElementById("loginform") 
          formElem.onsubmit = async (e) => {
            e.preventDefault();
            var data = new FormData(formElem);
            const username = data.get("username");
            const password = data.get("password");
  
  
            let result = await Auth.login(username, password);
  
            if (result.status ===200){
              var newLoginLayout = document.getElementById("loginform");
              newLoginLayout.innerHTML = `<a><b>Logged in as ${username} </b></a><input type="button" value="Logout" style="float: right;">`
            }else{
              var newLoginFailLayout = document.getElementById("errorTarget");
              var loginFailElement = document.createElement('a');
              //clearing the input form
              document.getElementById("username").value= '';
              document.getElementById("password").value = '';

              newLoginFailLayout.innerHTML = `<b style="color:red;">Login Failed, please try again</b>`;
            }
          }
  
         </script>
        <!--******************************script for login implemented above-->

    <div id="content">
      <!-- Form for login added 8 May2021-->
      <form id="loginform" style="margin-top: 10px;">
        <a style="margin-right: 5px;">User :</a>
        <input type="text" name="username" id="username" placeholder="Your username"/>
        <a style="margin-right: 5px;">Password :</a>
        <input type="password" name="password" id="password" placeholder="Your password"/>
        <input type="submit">
        <a id="errorTarget"></a>
       </form> 
     <!--form implemented above-->
      <div id="heading">

          <hgroup>
              <h1>Welcome to FlowTow!</h1>
          </hgroup>
      
          

      </div>
    </div>
  <div id = "bigdiv">
    <div id="three-images" class="flowtow">      
    </div>
    
    <div id="target">
    <div class="containerdiv" id="lefthandsidediv"> <!--This is the left hand side box for recent posts-->
      <h4 style="text-align: center; color: rgb(114, 70, 131);">Recent Posts</h4>
      
     

    </div>
    
    
    <!--This is for popular posts-->
    <div class="containerdiv" id="righthandsidediv"> 
      <h4 style="text-align: center; color: rgb(114, 70, 131);">Popular Posts</h4>
    </div>
    </div>
  </div>

      <!-- about section-->
  <section id="whatis">
    <div>
      <h3>What is FlowTow?</h3>
      <a>FlowTow is new, exciting, image sharing service like nothing you've seen before!</a>
      <br>
      <a>FlowTow supports logging in users, posting images, making comments and viewing images in various ways.</a>
    </div>
  </section>

  <footer>

    <div >
      <ul class="social">
        <li class="sociallist"><a href="#"><i class="fa fa-twitter"></i></a></li>
        <li class="sociallist"><a href="#"><i class="fa fa-facebook"></i></a></li>
        <li class="sociallist"><a href="#"><i href="#" class="fa fa-instagram"></a></i></li>
        <li class="sociallist"><a href="#">Terms</a></li>
        <li class="sociallist"><a href="#">Privacy</a></li>
        <li class="sociallist"><a href="#">Cookies</a></li>
      </ul>
    </div>

    
    
  </footer>
  <p id="copyright">All content and images subject to copyright &copy; COMP2110/6110 FlowTow 2021.</p>




  <!--Script for doing the most recent and popular posts-->
  <script type="module"> //script for adding images by timestamp.. involves sorting the array of objects with their timestamp
    

    
     var recentPostData = [];
     import{Model} from '/js/model.js'
     recentPostData = await Model.getPosts2();  


     //making 3 random post layout
     var mydata = recentPostData
     for (var i=0; i<3; i++){
                var index = Math.floor(Math.random() * mydata.length);
                var div1 = document.createElement('div');        // Create an <img> element.
                div1.innerHTML = '<img src='+mydata[index].p_url+'>' + '<a class="caption">'+ mydata[index].p_caption + ' by ' + mydata[index].p_author.username + ' <b>' + mydata[index].p_likes + '</b></a>';                 //giving the image url from data
                document.getElementById('three-images').appendChild(div1);  //appending the image to the div
              }       
     var popularPostData = recentPostData;   
     recentPostData.sort(function(a,b){
      return new Date(b.published_at) - new Date(a.published_at);
     });

     //making recent posts layout
     for (var i=0; i<10; i++){
       var div4 = document.createElement('div');        // Create an <div> element.
       div4.className = "divforposts"
       div4.innerHTML = '<img src='+recentPostData[i].p_url+'>' + '<a style="padding-bottom: 20px;">'+ recentPostData[i].p_caption + ' by ' + recentPostData[i].p_author.username + ' &nbsp &nbsp &nbsp' + recentPostData[i].published_at.split('T')[0] + ' <span style="color:blue;";><b>' + ' &nbsp' + recentPostData[i].p_likes + '</b></span></a><button class="like" type="button" style="float: right;">Like</button>';                 //giving the image url from data
       document.getElementById('lefthandsidediv').appendChild(div4);  //appending the element to parent div
     }

     //Making popular posts layout
     popularPostData.sort(function(a,b){
      return b.p_likes - a.p_likes;
     });
 
      for (i=0; i<10; i++){
        var div3 = document.createElement('div');        // Create an <div> element.
        div3.className = "divforposts"
        div3.innerHTML = '<img src='+popularPostData[i].p_url+'>' + '<a style="padding-bottom: 20px;">'+ popularPostData[i].p_caption + ' by ' + popularPostData[i].p_author.username + ' &nbsp &nbsp &nbsp' + popularPostData[i].published_at.split("T" , 1) + ' <span style="color:blue;";><b>' + ' &nbsp' + popularPostData[i].p_likes + '</b></span></a><button class="like" type="button" style="float: right;">Like</button>';                 //giving the image url from data
        document.getElementById('righthandsidediv').appendChild(div3);  //appending the element to parent div
      }
      

     document.querySelectorAll('.like').forEach(item => {
     item.onclick = async function(){
      //Need to do something here
      this.innerHTML = "wowzaaa" 
       // var likeNumber = this.previousSibling.firstElementChild.firstElementChild.innerHTML.split(';')[1];
       // console.log (likeNumber);
       // await Model.addLike(6);
     }
   })
  
     
              
   </script>

  

  </body>
</html>
